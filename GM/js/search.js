$(document).ready((function(){var t=$("#search-input-name"),e=$("#search-input-location"),n=$(".master-search__form form"),a=$(".master-search-button"),o=[];function i(){return window.innerWidth<767}function l(t){return{position:function(e,n){var a=function(t){$(t);var e=t.getBoundingClientRect(),n=$(window).height(),a=($(window).scrollTop(),e.top);return n-e.bottom>=200?{my:"left top",at:"left bottom+2",collision:"flip"}:a>=200?{my:"left bottom",at:"left top-2",collision:"flip"}:{my:"left top",at:"left bottom+2",collision:"flip"}}(t[0]);n.element.position({my:a.my,at:a.at,of:t,collision:a.collision}),setTimeout((function(){var e=n.element,a=e[0].getBoundingClientRect(),o=$(window).height();a.bottom>o&&e.position({my:"left bottom",at:"left top-2",of:t,collision:"flip"}),a.top<0&&e.position({my:"left top",at:"left bottom+2",of:t,collision:"flip"})}),0)}}}function c(){var n=""!==t.val().trim(),o=""!==e.val().trim();a.prop("disabled",!(n||o)),t.next(".clear-input").toggle(n),e.next(".clear-input").toggle(o)}function s(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.closest('[role="tablist"]'),o=a.querySelectorAll('[role="tab"]'),l=a.parentElement,c=l.querySelectorAll('[role="tabpanel"]'),s=Array.from(o).indexOf(e);if(i()){if(t===e&&n)return e.setAttribute("tabindex","-1"),e.setAttribute("aria-selected","false"),c[s].hidden=!0,void(Array.from(c).every((function(t){return t.hidden}))&&document.body.classList.remove("panel-visible"));o.forEach((function(t,n){t!==e&&(t.setAttribute("tabindex","-1"),t.setAttribute("aria-selected","false"),c[n]&&(c[n].hidden=!0))}))}e.focus(),t&&(t.setAttribute("tabindex","-1"),t.setAttribute("aria-selected","false")),e.setAttribute("tabindex","0"),e.setAttribute("aria-selected","true"),o.forEach((function(t,e){var a=c[e];if(a){var o=e===s&&!n;a.hidden=!o,t.setAttribute("aria-controls",a.id||"panel-".concat(e)),a.setAttribute("aria-labelledby",t.id||"tab-".concat(e))}})),Array.from(c).some((function(t){return!t.hidden}))?document.body.classList.add("panel-visible"):document.body.classList.remove("panel-visible");var r=l.querySelector(".tab-panel-wrapper");r&&!n&&(r.scrollTop=0)}function r(){document.querySelectorAll('[role="tablist"]').forEach((function(t){var e=t.querySelectorAll('[role="tab"]'),n=t.parentElement.querySelectorAll('[role="tabpanel"]');i()?e.forEach((function(t,e){t.setAttribute("tabindex","-1"),t.setAttribute("aria-selected","false"),n[e]&&(n[e].hidden=!0)})):(e.forEach((function(t){var e="true"===t.getAttribute("aria-selected");t.setAttribute("tabindex",e?"0":"-1")})),!t.querySelector('[aria-selected="true"]')&&e.length>0&&s(null,e[0]))}))}$.ajax({url:"./data/therapists.json",method:"GET",dataType:"json",success:function(u){o=u._source?[u._source]:[u],console.log("Loaded data:",o),a.prop("disabled",!0),t.after('<button type="button" class="clear-input" style="display: none;" aria-label="Clear name search input">×</button>'),e.after('<button type="button" class="clear-input" style="display: none;" aria-label="Clear location search input">×</button>'),t.add(e).on("input",c),$(".clear-input").on("click",(function(){$(this).prev("input").val("").trigger("input")})),t.closest(".form-item").css("position","relative"),e.closest(".form-item").css("position","relative"),t.autocomplete({minLength:1,appendTo:t.parent(),delay:300,source:function(t,e){var n=t.term.toLowerCase(),a=[],i=new Set;o.forEach((function(t){var e="".concat(t.nom||""," ").concat(t.prenom||"").trim().toLowerCase();e.includes(n)&&!i.has(e)&&(a.push({label:e,value:e,type:"name",item:t}),i.add(e)),t.nom_cpl&&t.nom_cpl.toLowerCase().includes(n)&&!i.has(t.nom_cpl)&&(a.push({label:t.nom_cpl,value:t.nom_cpl,type:"establishment",item:t}),i.add(t.nom_cpl)),t.therapie&&t.therapie.fr&&t.therapie.fr.split(",").map((function(t){return t.trim()})).forEach((function(e){e.toLowerCase().includes(n)&&!i.has(e)&&(a.push({label:e,value:e,type:"therapy",item:t}),i.add(e))}))})),e(a.slice(0,10))},select:function(e,n){var a=this;return t.val(n.item.value),c(),setTimeout((function(){$(a).autocomplete("close")}),0),!1},close:function(t,e){$(this).autocomplete("close")},open:function(){l(t).position(null,{element:$(this).autocomplete("widget")})}}).data("ui-autocomplete")._renderItem=function(t,e){var n=new RegExp(this.term,"gi"),a=e.label.replace(n,(function(t){return"<strong>".concat(t,"</strong>")})),o="";switch(e.type){case"name":o='<img src="images/user-icon-grey.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>';break;case"establishment":o='<img src="images/location-icon.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>';break;case"therapy":o='<img src="images/medical.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>'}return $("<li>").append("<div>".concat(o).concat(a,"</div>")).addClass("ui-menu-item-with-icon").appendTo(t)},e.autocomplete({minLength:1,delay:300,appendTo:e.closest(".form-item"),classes:{"ui-autocomplete":"ui-autocomplete search-autocomplete"},source:function(t,e){var n=t.term.toLowerCase(),a=[],i=new Set;o.forEach((function(t){if(t.ville||t.npa){var e="".concat(t.npa||""," ").concat(t.ville||"").trim();!i.has(e)&&(t.ville&&t.ville.toLowerCase().includes(n)||t.npa&&t.npa.toString().includes(n))&&(a.push({label:e,value:e,item:t}),i.add(e))}t.canton&&t.canton.toLowerCase().includes(n)&&!i.has(t.canton)&&(a.push({label:t.canton,value:t.canton,item:t}),i.add(t.canton))})),e(a.slice(0,10))},select:function(t,n){var a=this;return e.val(n.item.value),c(),setTimeout((function(){$(a).autocomplete("close")}),0),!1},close:function(t,e){$(this).autocomplete("close")},open:function(){l(e).position(null,{element:$(this).autocomplete("widget")})}}).data("ui-autocomplete")._renderItem=function(t,e){var n=new RegExp(this.term,"gi"),a=e.label.replace(n,(function(t){return"<strong>".concat(t,"</strong>")}));return $("<li>").append('<div><img src="images/location-icon.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>'.concat(a,"</div>")).addClass("ui-menu-item-with-icon").appendTo(t)},$(window).on("scroll",(function(){t.data("ui-autocomplete")&&t.autocomplete("widget").is(":visible")&&l(t).position(null,{element:t.autocomplete("widget")}),e.data("ui-autocomplete")&&e.autocomplete("widget").is(":visible")&&l(e).position(null,{element:e.autocomplete("widget")})})),n.on("submit",(function(n){n.preventDefault();var a=t.val().trim(),i=e.val().trim();a||i?function(t,e){!function(t){var e=$(".master-search-tab");if(e.empty(),0===t.length)return e.html('<p class="no-results">Aucun résultat trouvé</p>'),void e.removeClass("has-results").addClass("no-results-found");e.addClass("has-results").removeClass("no-results-found");var n=$('<div role="tablist" class="tablist"></div>'),a=$('<div class="tab-panel-wrapper"></div>'),o=window.innerWidth<767;t.forEach((function(t,e){var i,l,c,s="tab".concat(e+1),r="panel".concat(e+1),u=$('\n        <button role="tab" id="'.concat(s,'" aria-controls="').concat(r,'" \n                aria-selected="').concat(!o&&0===e,'" tabindex="').concat(0===e?"0":"-1",'" \n                class="tab">\n            <span class="tab-list__block">\n                <span class="tab-list__block--count">').concat(e+1,'</span>\n                <span class="tab-list__block--subtitle">\n                    <span class="tab-list__block--name">').concat(t.nom," ").concat(t.prenom,'</span>\n                    <span class="tab-list__block--contact">\n                        <span class="tab-list__block--contact-item">\n                            <img src="images/search-icon-location.svg" alt="location" width="16" height="16"/>\n                            ').concat(t.npa," ").concat(t.ville,", ").concat(t.rue," ").concat(t.rue_number,"\n                        </span>\n                        ").concat(t.phone?'\n                        <span class="tab-list__block--contact-item">\n                            <img src="images/search-icon-phone.svg" alt="phone" width="16" height="16"/>\n                            '.concat(t.phone,"\n                        </span>"):"",'\n                    </span>\n                    <span class="tab-list__block--tag-list">\n                        ').concat(t.therapie&&t.therapie.fr?(l=(i=t.therapie.fr.split(",").map((function(t){return t.trim()}))).slice(0,2),c=i.length-2,"\n                                ".concat(l.map((function(t){return'\n                                    <span class="tag-item"><span class="tag-text">'.concat(t,"</span></span>\n                                ")})).join(""),"\n                                ").concat(c>0?'\n                                    <span class="tag-item"><span class="tag-text count">+'.concat(c,"</span></span>\n                                "):"","\n                            ")):"","\n                    </span>\n                </span>\n            </span>\n        </button>\n      ")),p=$('\n        <div id="'.concat(r,'" role="tabpanel" tabindex="0" \n             aria-labelledby="').concat(s,'" class="tabpanel" ').concat(o||0!==e?"hidden":"",'>\n            <div class="tabpanel-content-block">\n                \n                <div class="tabpanel-profile-data">\n                <div class="panel-head">\n                <div class="tab-close">\n                    <img src="images/tab-panel-close.svg" alt="close" width="22" height="22">\n                </div>\n                <p class="profile-lead-text">\n                        <img src="images/user-icon.svg" alt="profile" width="24" height="24"/>\n                        ').concat(t.genre.fr,'\n                    </p>\n                    <h3 class="title-3">').concat(t.nom," ").concat(t.prenom,'</h3>\n                    </div>\n                    \n                    <div class="profile-summary">\n                        \n                        <div class="tab-list__block--tag-list language-tag">\n                            ').concat(t.langue.split(",").map((function(t){return'\n                                <span class="tag-item">\n                                    <span class="tag-text">'.concat(t.trim(),"</span>\n                                </span>\n                              ")})).join(""),'\n                        </div>\n                        <div class="tab-list__block--tag-list">\n                            ').concat(t.affiliation?t.affiliation.split(",").map((function(t){return'\n                                <span class="tag-item">\n                                    <span class="tag-text">'.concat(t.trim(),'</span>\n                                    <button class="tooltip" aria-label="Information about ASCA accreditation" aria-describedby="').concat(t.trim(),'">\n    <img src="images/tool-tip.svg" alt="" width="12" height="12" aria-hidden="true">\n    <span class="tooltiptext" role="tooltip" id="').concat(t.trim(),"\">\n        ASCA est l'organisme suisse d'accréditation des médecines complémentaires : seuls ses thérapeutes agréés sont éligibles à un remboursement partiel par l'assurance maladie.\n    </span>\n</button>\n                                </span>\n                            ")})).join(""):"",'\n                        </div>\n                        <div class="profile-highlight">\n                            <p class="highlight-text">Prise en charge sous certaines conditions d\'assurances</p>\n                            <p class="normal-text">Veuillez verifier vos conditions d\'assurances complémentaires</p>\n                        </div>\n                        <ul class="profile-contact">\n                            <li class="profile-contact-list">\n                                <img src="images/search-icon-location.svg" alt="location" width="24" height="24"/>\n                                ').concat(t.canton,", ").concat(t.npa," ").concat(t.ville,", ").concat(t.rue," ").concat(t.rue_number,"\n                            </li>\n                            ").concat(t.nom_cpl?'\n                            <li class="profile-contact-list">\n                                <img src="images/search-icon-pin.svg" alt="practice" width="24" height="24"/>\n                                '.concat(t.nom_cpl,"\n                            </li>"):"","\n                            ").concat(t.phone?'\n                            <li class="profile-contact-list">\n                                <img src="images/search-icon-phone.svg" alt="phone" width="24" height="24"/>\n                                '.concat(t.phone,"\n                            </li>"):"",'\n                        </ul>\n                        <div class="profile-detail-listing">\n                            <h4 class="title-4">Thérapies couvertes sous conditions</h4>\n                            <ul>\n                                ').concat(t.therapie.fr.split(",").map((function(t){return"\n                                    <li>".concat(t.trim(),"</li>\n                                ")})).join(""),"\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n      "));n.append(u),a.append(p)})),e.append(n).append(a),r()}(o.filter((function(n){var a="".concat(n.nom||""," ").concat(n.prenom||"").trim().toLowerCase(),o=(n.nom_cpl||"").toLowerCase(),i=(n.therapie&&n.therapie.fr?n.therapie.fr:"").toLowerCase(),l="".concat(n.npa||""," ").concat(n.ville||""," ").concat(n.canton||"").trim().toLowerCase(),c=!t||a.includes(t.toLowerCase())||o.includes(t.toLowerCase())||i.includes(t.toLowerCase()),s=!e||l.includes(e.toLowerCase());return c&&s})))}(a,i):alert("Veuillez entrer au moins un critère de recherche")})),document.body.addEventListener("click",(function(t){var e=t.target.closest('[role="tab"]');if(e){var n=e.closest('[role="tablist"]');if(n){var a=n.querySelector('[aria-selected="true"]');i()&&a===e?s(a,e,!0):a!==e&&s(a,e)}}})),document.body.addEventListener("click",(function(t){var e=t.target.closest(".tab-close");if(e){var n=e.closest('[role="tabpanel"]');if(n){var a=n.getAttribute("aria-labelledby"),o=document.getElementById(a);o&&s(o.closest('[role="tablist"]').querySelector('[aria-selected="true"]'),o,!0)}}})),document.body.addEventListener("keydown",(function(t){var e=t.target.closest('[role="tab"]');if(e){var n=e.closest('[role="tablist"]');if(n){var a,o=n.querySelectorAll('[role="tab"]'),i=n.querySelector('[aria-selected="true"]'),l=Array.from(o),c=l.indexOf(e);switch(t.key){case"ArrowUp":t.preventDefault(),a=0===c?l[l.length-1]:l[c-1];break;case"ArrowDown":t.preventDefault(),a=c===l.length-1?l[0]:l[c+1];break;default:return}a&&s(i,a)}}})),window.addEventListener("resize",(function(){r(),t.data("ui-autocomplete")&&t.autocomplete("close"),e.data("ui-autocomplete")&&e.autocomplete("close")})),r()},error:function(t,e,n){console.error("Error loading initial data:",n)}})}));