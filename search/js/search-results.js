$(document).ready((function(){console.log("lijo");var t=$("#search-input-name"),n=$("#search-input-location"),e=$(".master-search__form form"),a=$(".master-search-button"),i=[];function o(){var e=""!==t.val().trim(),i=""!==n.val().trim();a.prop("disabled",!(e||i)),t.next(".clear-input").toggle(e),n.next(".clear-input").toggle(i)}function c(t){var n=t.target,e=n.parentNode,a=e.parentNode;e.querySelectorAll('[aria-selected="true"]').forEach((function(t){return t.setAttribute("aria-selected",!1)})),n.setAttribute("aria-selected",!0),a.querySelectorAll('[role="tabpanel"]').forEach((function(t){return t.setAttribute("hidden",!0)})),a.querySelector("#".concat(n.getAttribute("aria-controls"))).removeAttribute("hidden")}a.prop("disabled",!0),t.after('<button type="button" class="clear-input" style="display: none;">×</button>'),n.after('<button type="button" class="clear-input" style="display: none;">×</button>'),t.add(n).on("input",o),$(".clear-input").on("click",(function(){$(this).prev("input").val("").trigger("input")})),$.ajax({url:"./data/therapists.json",method:"GET",dataType:"json",success:function(e){i=e._source?[e._source]:[e],console.log("Loaded data:",i),t.closest(".form-item").css("position","relative"),n.closest(".form-item").css("position","relative"),t.autocomplete({minLength:1,appendTo:t.parent(),position:{my:"left top+2",at:"left bottom",collision:"none"},delay:300,source:function(t,n){var e=t.term.toLowerCase(),a=[],o=new Set;i.forEach((function(t){var n="".concat(t.nom||""," ").concat(t.prenom||"").trim().toLowerCase();n.includes(e)&&!o.has(n)&&(a.push({label:n,value:n,type:"name",item:t}),o.add(n)),t.nom_cpl&&t.nom_cpl.toLowerCase().includes(e)&&!o.has(t.nom_cpl)&&(a.push({label:t.nom_cpl,value:t.nom_cpl,type:"establishment",item:t}),o.add(t.nom_cpl)),t.therapie&&t.therapie.fr&&t.therapie.fr.split(",").map((function(t){return t.trim()})).forEach((function(n){n.toLowerCase().includes(e)&&!o.has(n)&&(a.push({label:n,value:n,type:"therapy",item:t}),o.add(n))}))})),n(a.slice(0,10))},select:function(n,e){return t.val(e.item.value),o(),!1}}).data("ui-autocomplete")._renderItem=function(t,n){var e=new RegExp(this.term,"gi"),a=n.label.replace(e,(function(t){return"<strong>".concat(t,"</strong>")})),i="";switch(n.type){case"name":i='<img src="images/user-icon-grey.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>';break;case"establishment":i='<img src="images/location-icon.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>';break;case"therapy":i='<img src="images/home-grey.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>'}return $("<li>").append("<div>".concat(i).concat(a,"</div>")).addClass("ui-menu-item-with-icon").appendTo(t)},n.autocomplete({minLength:1,delay:300,appendTo:n.closest(".form-item"),position:{my:"left top",at:"left bottom+2",collision:"none"},classes:{"ui-autocomplete":"ui-autocomplete search-autocomplete"},source:function(t,n){var e=t.term.toLowerCase(),a=[],o=new Set;i.forEach((function(t){if(t.ville||t.npa){var n="".concat(t.npa||""," ").concat(t.ville||"").trim();!o.has(n)&&(t.ville&&t.ville.toLowerCase().includes(e)||t.npa&&t.npa.toString().includes(e))&&(a.push({label:n,value:n,item:t}),o.add(n))}t.canton&&t.canton.toLowerCase().includes(e)&&!o.has(t.canton)&&(a.push({label:t.canton,value:t.canton,item:t}),o.add(t.canton))})),n(a.slice(0,10))},select:function(t,e){return n.val(e.item.value),o(),!1}}).data("ui-autocomplete")._renderItem=function(t,n){var e=new RegExp(this.term,"gi"),a=n.label.replace(e,(function(t){return"<strong>".concat(t,"</strong>")}));return $("<li>").append('<div><img src="images/location-icon.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>'.concat(a,"</div>")).addClass("ui-menu-item-with-icon").appendTo(t)}},error:function(t,n,e){console.error("Error loading initial data:",e)}}),e.on("submit",(function(e){e.preventDefault();var a=t.val().trim(),o=n.val().trim();a||o?function(t,n){!function(t){var n=$(".master-search-tab");if(n.empty(),0===t.length)return n.html('<p class="no-results">Aucun résultat trouvé</p>'),void n.removeClass("has-results").addClass("no-results-found");n.addClass("has-results").removeClass("no-results-found");var e,a,i=$('<div role="tablist" class="tab-list"></div>'),o=$('<div class="tab-panel-wrapper"></div>');t.forEach((function(t,n){var e="tab".concat(n+1),a="panel".concat(n+1),c=$('\n                <button role="tab" id="'.concat(e,'" aria-controls="').concat(a,'" \n                        aria-selected="').concat(0===n,'" tabindex="').concat(0===n?"0":"-1",'" \n                        class="tab">\n                    <span class="tab-list__block">\n                        <span class="tab-list__block--count">').concat(n+1,'</span>\n                        <span class="tab-list__block--subtitle">\n                            <span class="tab-list__block--name">').concat(t.nom," ").concat(t.prenom,'</span>\n                            <span class="tab-list__block--contact">\n                                <span class="tab-list__block--contact-item">\n                                    <img src="images/search-icon-location.svg" alt="location" width="16" height="16"/>\n                                    ').concat(t.npa," ").concat(t.ville,", ").concat(t.rue," ").concat(t.rue_number,"\n                                </span>\n                                ").concat(t.phone?'\n                                <span class="tab-list__block--contact-item">\n                                    <img src="images/search-icon-phone.svg" alt="phone" width="16" height="16"/>\n                                    '.concat(t.phone,"\n                                </span>"):"",'\n                            </span>\n                            <span class="tab-list__block--tag-list">\n                                ').concat(t.affiliation?t.affiliation.split(",").map((function(t){return'\n                                    <span class="tag-item"><span class="tag-text">'.concat(t.trim(),"</span></span>\n                                ")})).join(""):"","\n                            </span>\n                        </span>\n                    </span>\n                </button>\n            ")),s=$('\n                <div id="'.concat(a,'" role="tabpanel" tabindex="0" \n                     aria-labelledby="').concat(e,'" class="tabpanel" ').concat(0!==n?"hidden":"",'>\n                    <div class="tabpanel-content-block">\n                        <div class="tab-close">\n                            <img src="images/tab-panel-close.svg" alt="close" width="22" height="22">\n                        </div>\n                        <div class="tabpanel-profile-data">\n                            <p class="profile-lead-text">\n                                <img src="images/user-icon.svg" alt="profile" width="24" height="24"/>\n                                ').concat(t.genre.fr,'\n                            </p>\n                            <div class="profile-summary">\n                                <h3 class="title-3">').concat(t.nom," ").concat(t.prenom,'</h3>\n                                <div class="tab-list__block--tag-list">\n                                    ').concat(t.affiliation?t.affiliation.split(",").map((function(t){return'\n                                        <span class="tag-item">\n                                            <span class="tag-text">'.concat(t.trim(),'</span>\n                                            <span class="tooltip">\n                                                <img src="images/tool-tip.svg" alt="" width="12" height="12">\n                                                <span class="tooltiptext">ASCA est l\'organisme suisse d\'accréditation des médecines complémentaires : seuls ses thérapeutes agréés sont éligibles à un remboursement partiel par l\'assurance maladie.</span>\n                                            </span>\n                                        </span>\n                                    ')})).join(""):"",'\n                                </div>\n                                <div class="profile-highlight">\n                                    <p class="highlight-text">Prise en charge sous certaines conditions d\'assurances</p>\n                                    <p class="normal-text">Veuillez verifier vos conditions d\'assurances complémentaires</p>\n                                </div>\n                                <ul class="profile-contact">\n                                    <li class="profile-contact-list">\n                                        <img src="images/search-icon-location.svg" alt="location" width="24" height="24"/>\n                                        ').concat(t.canton,", ").concat(t.npa," ").concat(t.ville,", ").concat(t.rue," ").concat(t.rue_number,"\n                                    </li>\n                                    ").concat(t.nom_cpl?'\n                                    <li class="profile-contact-list">\n                                        <img src="images/search-icon-pin.svg" alt="practice" width="24" height="24"/>\n                                        '.concat(t.nom_cpl,"\n                                    </li>"):"","\n                                    ").concat(t.phone?'\n                                    <li class="profile-contact-list">\n                                        <img src="images/search-icon-phone.svg" alt="phone" width="24" height="24"/>\n                                        '.concat(t.phone,"\n                                    </li>"):"",'\n                                </ul>\n                                <div class="profile-detail-listing">\n                                    <h4 class="title-4">Thérapies couvertes sous conditions</h4>\n                                    <ul>\n                                        ').concat(t.therapie.fr.split(",").map((function(t){return"\n                                            <li>".concat(t.trim(),"</li>\n                                        ")})).join(""),"\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            "));i.append(c),o.append(s)})),n.append(i).append(o),e=document.querySelectorAll('[role="tab"]'),a=document.querySelector('[role="tablist"]'),e.forEach((function(t){t.addEventListener("click",c)})),a.addEventListener("keydown",(function(t){var n=t.target;if("tab"===n.getAttribute("role")){var a=Array.from(e),i=a.indexOf(n),o=37===t.which?i-1:39===t.which?i+1:36===t.which?0:35===t.which?a.length-1:null;null!==o&&(t.preventDefault(),a[o=o<0?a.length-1:o>=a.length?0:o].focus(),a[o].click())}}))}(i.filter((function(e){var a="".concat(e.nom||""," ").concat(e.prenom||"").trim().toLowerCase(),i=(e.nom_cpl||"").toLowerCase(),o=(e.therapie&&e.therapie.fr?e.therapie.fr:"").toLowerCase(),c=("".concat(e.rue||""," ").concat(e.rue_number||"",", ").concat(e.npa||""," ").concat(e.ville||"").trim().toLowerCase(),"".concat(e.npa||""," ").concat(e.ville||""," ").concat(e.canton||"").trim().toLowerCase()),s=!t||a.includes(t.toLowerCase())||i.includes(t.toLowerCase())||o.includes(t.toLowerCase()),l=!n||c.includes(n.toLowerCase());return s&&l})))}(a,o):alert("Veuillez entrer au moins un critère de recherche")}))}));