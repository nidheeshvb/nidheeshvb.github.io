$(document).ready((function(){console.log("lijo");var t=$("#search-input-name"),n=$("#search-input-location"),a=$(".master-search__form form"),e=$(".master-search-button"),i=[];function o(){var a=""!==t.val().trim(),i=""!==n.val().trim();e.prop("disabled",!(a||i)),t.next(".clear-input").toggle(a),n.next(".clear-input").toggle(i)}e.prop("disabled",!0),t.after('<button type="button" class="clear-input" style="display: none;">×</button>'),n.after('<button type="button" class="clear-input" style="display: none;">×</button>'),t.add(n).on("input",o),$(".clear-input").on("click",(function(){$(this).prev("input").val("").trigger("input")})),$.ajax({url:"./data/therapists.json",method:"GET",dataType:"json",success:function(a){i=a._source?[a._source]:[a],console.log("Loaded data:",i),t.closest(".form-item").css("position","relative"),n.closest(".form-item").css("position","relative"),t.autocomplete({minLength:1,appendTo:t.parent(),position:{my:"left top+2",at:"left bottom",collision:"none"},delay:300,source:function(t,n){var a=t.term.toLowerCase(),e=[],o=new Set;i.forEach((function(t){var n="".concat(t.nom||""," ").concat(t.prenom||"").trim().toLowerCase();n.includes(a)&&!o.has(n)&&(e.push({label:n,value:n,type:"name",item:t}),o.add(n)),t.nom_cpl&&t.nom_cpl.toLowerCase().includes(a)&&!o.has(t.nom_cpl)&&(e.push({label:t.nom_cpl,value:t.nom_cpl,type:"establishment",item:t}),o.add(t.nom_cpl)),t.therapie&&t.therapie.fr&&t.therapie.fr.split(",").map((function(t){return t.trim()})).forEach((function(n){n.toLowerCase().includes(a)&&!o.has(n)&&(e.push({label:n,value:n,type:"therapy",item:t}),o.add(n))}))})),n(e.slice(0,10))},select:function(n,a){return t.val(a.item.value),o(),!1}}).data("ui-autocomplete")._renderItem=function(t,n){var a=new RegExp(this.term,"gi"),e=n.label.replace(a,(function(t){return"<strong>".concat(t,"</strong>")})),i="";switch(n.type){case"name":i='<img src="images/user-icon-grey.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>';break;case"establishment":i='<img src="images/location-icon.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>';break;case"therapy":i='<img src="images/home-grey.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>'}return $("<li>").append("<div>".concat(i).concat(e,"</div>")).addClass("ui-menu-item-with-icon").appendTo(t)},n.autocomplete({minLength:1,delay:300,appendTo:n.closest(".form-item"),position:{my:"left top",at:"left bottom+2",collision:"none"},classes:{"ui-autocomplete":"ui-autocomplete search-autocomplete"},source:function(t,n){var a=t.term.toLowerCase(),e=[],o=new Set;i.forEach((function(t){if(t.ville||t.npa){var n="".concat(t.npa||""," ").concat(t.ville||"").trim();!o.has(n)&&(t.ville&&t.ville.toLowerCase().includes(a)||t.npa&&t.npa.toString().includes(a))&&(e.push({label:n,value:n,item:t}),o.add(n))}t.canton&&t.canton.toLowerCase().includes(a)&&!o.has(t.canton)&&(e.push({label:t.canton,value:t.canton,item:t}),o.add(t.canton))})),n(e.slice(0,10))},select:function(t,a){return n.val(a.item.value),o(),!1}}).data("ui-autocomplete")._renderItem=function(t,n){var a=new RegExp(this.term,"gi"),e=n.label.replace(a,(function(t){return"<strong>".concat(t,"</strong>")}));return $("<li>").append('<div><img src="images/location-icon.svg" alt="" width="16" height="16" style="margin-right: 8px;"/>'.concat(e,"</div>")).addClass("ui-menu-item-with-icon").appendTo(t)}},error:function(t,n,a){console.error("Error loading initial data:",a)}}),a.on("submit",(function(a){a.preventDefault();var e=t.val().trim(),o=n.val().trim();e||o?function(t,n){!function(t){var n=$(".master-search-tab");if(n.empty(),0===t.length)return n.html('<p class="no-results">Aucun résultat trouvé</p>'),void n.removeClass("has-results").addClass("no-results-found");n.addClass("has-results").removeClass("no-results-found");var a=$('<div role="tablist" class="tablist"></div>'),e=$('<div class="tab-panel-wrapper"></div>'),i=window.innerWidth<767;t.forEach((function(t,n){var o="tab".concat(n+1),s="panel".concat(n+1),c=$('\n                <button role="tab" id="'.concat(o,'" aria-controls="').concat(s,'" \n                        aria-selected="').concat(!i&&0===n,'" tabindex="').concat(0===n?"0":"-1",'" \n                        class="tab">\n                    <span class="tab-list__block">\n                        <span class="tab-list__block--count">').concat(n+1,'</span>\n                        <span class="tab-list__block--subtitle">\n                            <span class="tab-list__block--name">').concat(t.nom," ").concat(t.prenom,'</span>\n                            <span class="tab-list__block--contact">\n                                <span class="tab-list__block--contact-item">\n                                    <img src="images/search-icon-location.svg" alt="location" width="16" height="16"/>\n                                    ').concat(t.npa," ").concat(t.ville,", ").concat(t.rue," ").concat(t.rue_number,"\n                                </span>\n                                ").concat(t.phone?'\n                                <span class="tab-list__block--contact-item">\n                                    <img src="images/search-icon-phone.svg" alt="phone" width="16" height="16"/>\n                                    '.concat(t.phone,"\n                                </span>"):"",'\n                            </span>\n                            <span class="tab-list__block--tag-list">\n                                ').concat(t.affiliation?t.affiliation.split(",").map((function(t){return'\n                                    <span class="tag-item"><span class="tag-text">'.concat(t.trim(),"</span></span>\n                                ")})).join(""):"","\n                            </span>\n                        </span>\n                    </span>\n                </button>\n            ")),l=$('\n                <div id="'.concat(s,'" role="tabpanel" tabindex="0" \n                     aria-labelledby="').concat(o,'" class="tabpanel" ').concat(i||0!==n?"hidden":"",'>\n                    <div class="tabpanel-content-block">\n                        <div class="tab-close">\n                            <img src="images/tab-panel-close.svg" alt="close" width="22" height="22">\n                        </div>\n                        <div class="tabpanel-profile-data">\n                            <p class="profile-lead-text">\n                                <img src="images/user-icon.svg" alt="profile" width="24" height="24"/>\n                                ').concat(t.genre.fr,'\n                            </p>\n                            <div class="profile-summary">\n                                <h3 class="title-3">').concat(t.nom," ").concat(t.prenom,'</h3>\n                                <div class="tab-list__block--tag-list">\n                                    ').concat(t.affiliation?t.affiliation.split(",").map((function(t){return'\n                                        <span class="tag-item">\n                                            <span class="tag-text">'.concat(t.trim(),'</span>\n                                            <span class="tooltip">\n                                                <img src="images/tool-tip.svg" alt="" width="12" height="12">\n                                                <span class="tooltiptext">ASCA est l\'organisme suisse d\'accréditation des médecines complémentaires : seuls ses thérapeutes agréés sont éligibles à un remboursement partiel par l\'assurance maladie.</span>\n                                            </span>\n                                        </span>\n                                    ')})).join(""):"",'\n                                </div>\n                                <div class="profile-highlight">\n                                    <p class="highlight-text">Prise en charge sous certaines conditions d\'assurances</p>\n                                    <p class="normal-text">Veuillez verifier vos conditions d\'assurances complémentaires</p>\n                                </div>\n                                <ul class="profile-contact">\n                                    <li class="profile-contact-list">\n                                        <img src="images/search-icon-location.svg" alt="location" width="24" height="24"/>\n                                        ').concat(t.canton,", ").concat(t.npa," ").concat(t.ville,", ").concat(t.rue," ").concat(t.rue_number,"\n                                    </li>\n                                    ").concat(t.nom_cpl?'\n                                    <li class="profile-contact-list">\n                                        <img src="images/search-icon-pin.svg" alt="practice" width="24" height="24"/>\n                                        '.concat(t.nom_cpl,"\n                                    </li>"):"","\n                                    ").concat(t.phone?'\n                                    <li class="profile-contact-list">\n                                        <img src="images/search-icon-phone.svg" alt="phone" width="24" height="24"/>\n                                        '.concat(t.phone,"\n                                    </li>"):"",'\n                                </ul>\n                                <div class="profile-detail-listing">\n                                    <h4 class="title-4">Thérapies couvertes sous conditions</h4>\n                                    <ul>\n                                        ').concat(t.therapie.fr.split(",").map((function(t){return"\n                                            <li>".concat(t.trim(),"</li>\n                                        ")})).join(""),"\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            "));a.append(c),e.append(l)})),n.append(a).append(e),"function"==typeof window.initializeTabs&&window.initializeTabs()}(i.filter((function(a){var e="".concat(a.nom||""," ").concat(a.prenom||"").trim().toLowerCase(),i=(a.nom_cpl||"").toLowerCase(),o=(a.therapie&&a.therapie.fr?a.therapie.fr:"").toLowerCase(),s=("".concat(a.rue||""," ").concat(a.rue_number||"",", ").concat(a.npa||""," ").concat(a.ville||"").trim().toLowerCase(),"".concat(a.npa||""," ").concat(a.ville||""," ").concat(a.canton||"").trim().toLowerCase()),c=!t||e.includes(t.toLowerCase())||i.includes(t.toLowerCase())||o.includes(t.toLowerCase()),l=!n||s.includes(n.toLowerCase());return c&&l})))}(e,o):alert("Veuillez entrer au moins un critère de recherche")}))}));